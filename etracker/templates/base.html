{% load static %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ETracker - {% block title %}{% endblock %}</title>
    <script
      src="https://kit.fontawesome.com/93a0a9db14.js"
      crossorigin="anonymous"
    ></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <link rel="stylesheet" href="{% static 'styles/styles.css' %}" />
  </head>
  <body>
    <div class="shape shape1"></div>
    <div class="shape shape2"></div>
    <div class="shape shape3"></div>
    {% block content %}{% endblock %}
    <footer>
      <p>Copyright &copy; {% now "Y" %}, Eszter Diana Toth</p>
    </footer>
    <script>
      if (window.location.href == "http://127.0.0.1:8000/" || window.location.href.includes("http://127.0.0.1:8000/?next=/") || window.location.href.includes("/edit/") || window.location.href.includes("/comment/")) {
        document.body.className = "login";
      } else {
        document.body.className = "user";
      }

      if (window.location.href == "http://127.0.0.1:8000/ticket/new/") {
        document.getElementById("id_description").placeholder = document.getElementsByClassName("helptext")[0].innerText;
      }

      if (window.location.href.includes("/edit/") || window.location.href.includes("/comment/")) {
        $(".shape").hide();
      }

      $(document).ready(function(){
        $("#id_password").attr("type", "password");
        $("#id_password").click(function(){
          $(this).val("");
        });
      });

      $(document).ready(function(){
        window.onscroll = function(){
          // window.scrollY > 100 || window.pageYOffset > 100 || document.documentElement.scrollTop > 100 || document.body.scrollTop > 100
          if ($("html, body").scrollTop() > 100) {
            $("#back-to-top").fadeIn();
          } else {
            $("#back-to-top").fadeOut();
          }
        };
        
        $("#back-to-top").click(function(){
          $("html, body").animate({scrollTop:"0"});
        });
      });

      $(document).ready(function(){
        $(".accordion").each(function(){
          $(this).click(function(){
            $(this).toggleClass("active");
            $(this).next().children(".container-2").fadeToggle("slow");
            $(this).next().slideToggle("slow");
            if ($(this).hasClass("active") === false){
              setTimeout(() => {
                $(this).next().find(".container-1, .container-2, iframe").hide();
              }, 500);
            };
          });
        });
      });

      $(document).ready(function(){
        $(".edit-link").each(function(){
          $(this).click(function(){
            $(this).parent().next().children("iframe").fadeToggle("slow");
            $(this).parent().next().slideToggle("slow");
          });
        });
      });

      $(document).ready(function(){
        $("#editform :reset").click(function(){
          $(window.frameElement).fadeOut("slow");
          $(window.frameElement).parent().slideUp("slow");
        });
      });

      $(document).ready(function(){
        $(".comment-confirmation").click(function(){
          return confirm("Are you sure you want to delete this comment?");
        });
        $(".ticket-confirmation").click(function(){
          return confirm("Are you sure you want to delete the ticket and all of its comments?");
        });
      });

      $(document).ready(function(){
        $("#search-bar").keyup(function(){
            var input = $("#search-bar").val().toUpperCase().replace(/\s+/g, "");
            $(".accordion").each(function(){
              var txtValues = $(this).text().toUpperCase().replace(/\s+/g, "");
              if (txtValues.includes(input)) {
                $(this).show();
                $(this).prev(".hidden").show();
              } else {
                $(this).prev(".hidden").hide();
                $(this).hide();
                $(this).next().hide();
                $(this).next().find(".container-1, .container-2, iframe").hide();
                $(this).removeClass("active");
              };
            });
        });
      });

    </script>
  </body>
</html>
